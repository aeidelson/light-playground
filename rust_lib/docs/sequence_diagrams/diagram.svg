<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="595px" preserveAspectRatio="none" style="width:1157px;height:595px;" version="1.1" viewBox="0 0 1157 595" width="1157px" zoomAndPan="magnify"><defs><filter height="300%" id="f1noyx0ohjv2d" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1noyx0ohjv2d)" height="242.4844" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="603" y="294.3066"/><rect fill="#FFFFFF" filter="url(#f1noyx0ohjv2d)" height="91.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1012" y="415.5488"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="83" x2="83" y1="38.4883" y2="81.7988"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="83" x2="83" y1="81.7988" y2="122.7539"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="83" x2="83" y1="122.7539" y2="555.1016"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="275" x2="275" y1="38.4883" y2="81.7988"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="275" x2="275" y1="81.7988" y2="122.7539"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="275" x2="275" y1="122.7539" y2="555.1016"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="403" x2="403" y1="38.4883" y2="81.7988"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="403" x2="403" y1="81.7988" y2="122.7539"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="403" x2="403" y1="122.7539" y2="555.1016"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="608" x2="608" y1="38.4883" y2="81.7988"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="608" x2="608" y1="81.7988" y2="122.7539"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="608" x2="608" y1="122.7539" y2="555.1016"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="858.5" x2="858.5" y1="38.4883" y2="81.7988"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="858.5" x2="858.5" y1="81.7988" y2="122.7539"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="858.5" x2="858.5" y1="122.7539" y2="555.1016"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1016.5" x2="1016.5" y1="38.4883" y2="81.7988"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1016.5" x2="1016.5" y1="81.7988" y2="122.7539"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1016.5" x2="1016.5" y1="122.7539" y2="555.1016"/><rect fill="#FEFECE" filter="url(#f1noyx0ohjv2d)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="28" x="67" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="14" x="74" y="23.5352">UI</text><rect fill="#FEFECE" filter="url(#f1noyx0ohjv2d)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="28" x="67" y="554.1016"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="14" x="74" y="574.6367">UI</text><rect fill="#FEFECE" filter="url(#f1noyx0ohjv2d)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="233" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="240" y="23.5352">Simulator</text><rect fill="#FEFECE" filter="url(#f1noyx0ohjv2d)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="233" y="554.1016"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="240" y="574.6367">Simulator</text><rect fill="#FEFECE" filter="url(#f1noyx0ohjv2d)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="149" x="327" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="135" x="334" y="23.5352">TracerJobGenerator</text><rect fill="#FEFECE" filter="url(#f1noyx0ohjv2d)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="149" x="327" y="554.1016"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="135" x="334" y="574.6367">TracerJobGenerator</text><rect fill="#FEFECE" filter="url(#f1noyx0ohjv2d)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="232" x="490" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="218" x="497" y="23.5352">Tracer (one of multiple threads)</text><rect fill="#FEFECE" filter="url(#f1noyx0ohjv2d)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="232" x="490" y="554.1016"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="218" x="497" y="574.6367">Tracer (one of multiple threads)</text><rect fill="#FEFECE" filter="url(#f1noyx0ohjv2d)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="153" x="780.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="139" x="787.5" y="23.5352">LightSegmentQueue</text><rect fill="#FEFECE" filter="url(#f1noyx0ohjv2d)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="153" x="780.5" y="554.1016"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="139" x="787.5" y="574.6367">LightSegmentQueue</text><rect fill="#FEFECE" filter="url(#f1noyx0ohjv2d)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="65" x="982.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="51" x="989.5" y="23.5352">Surface</text><rect fill="#FEFECE" filter="url(#f1noyx0ohjv2d)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="65" x="982.5" y="554.1016"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="51" x="989.5" y="574.6367">Surface</text><rect fill="#FFFFFF" filter="url(#f1noyx0ohjv2d)" height="242.4844" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="603" y="294.3066"/><rect fill="#FFFFFF" filter="url(#f1noyx0ohjv2d)" height="91.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1012" y="415.5488"/><polygon fill="#FBFB77" filter="url(#f1noyx0ohjv2d)" points="32,53.4883,133,53.4883,143,64.4883,133,76.4883,32,76.4883,22,64.4883,32,53.4883" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="34" y="70.0566">User opens app</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="458" x="321" y="106.4336">The app is at a steady state (everything is intialized and something is being simulated)</text><polygon fill="#FBFB77" filter="url(#f1noyx0ohjv2d)" points="18,127.7539,149,127.7539,159,138.7539,149,150.7539,18,150.7539,8,138.7539,18,127.7539" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="20" y="144.3223">User modifies scene</text><polygon fill="#A80036" points="263,173.0645,273,177.0645,263,181.0645,267,177.0645" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="83" x2="269" y1="177.0645" y2="177.0645"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="90" y="172.6328">clear_and_simulate(layout)</text><polygon fill="#A80036" points="1005,202.375,1015,206.375,1005,210.375,1009,206.375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="275" x2="1011" y1="206.375" y2="206.375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="237" x="282" y="201.9434">clear_and_increment_layout_version()</text><polygon fill="#A80036" points="391.5,231.6855,401.5,235.6855,391.5,239.6855,395.5,235.6855" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="275" x2="397.5" y1="235.6855" y2="235.6855"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="282" y="231.2539">reset()</text><polygon fill="#A80036" points="847,260.9961,857,264.9961,847,268.9961,851,264.9961" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="275" x2="853" y1="264.9961" y2="264.9961"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="282" y="260.5645">dequeue_all()</text><polygon fill="#A80036" points="591,290.3066,601,294.3066,591,298.3066,595,294.3066" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="275" x2="597" y1="294.3066" y2="294.3066"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="282" y="289.875">condvar.notify_all()</text><polygon fill="#A80036" points="414.5,319.6172,404.5,323.6172,414.5,327.6172,410.5,323.6172" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="591,319.6172,601,323.6172,591,327.6172,595,323.6172" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="408.5" x2="597" y1="323.6172" y2="323.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="420.5" y="319.1855">dequeue_job()</text><rect fill="#FBFB77" filter="url(#f1noyx0ohjv2d)" height="23" style="stroke: #A80036; stroke-width: 1.0;" width="82" x="567" y="336.9277"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="74" x="571" y="353.4961">Trace scene</text><polygon fill="#A80036" points="847,382.2383,857,386.2383,847,390.2383,851,386.2383" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="613" x2="853" y1="386.2383" y2="386.2383"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="222" x="620" y="381.8066">enqueue(segments, layout_version)</text><polygon fill="#A80036" points="1000,411.5488,1010,415.5488,1000,419.5488,1004,415.5488" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="613" x2="1006" y1="415.5488" y2="415.5488"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="620" y="411.1172">condvar.notify_all()</text><polygon fill="#A80036" points="870,440.8594,860,444.8594,870,448.8594,866,444.8594" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1000,440.8594,1010,444.8594,1000,448.8594,1004,444.8594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="864" x2="1006" y1="444.8594" y2="444.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="876" y="440.4277">dequeue_segments()</text><rect fill="#FBFB77" filter="url(#f1noyx0ohjv2d)" height="23" style="stroke: #A80036; stroke-width: 1.0;" width="259" x="887" y="458.1699"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="891" y="474.7383">Draw segments if correct layout version</text><polygon fill="#A80036" points="286,503.4805,276,507.4805,286,511.4805,282,507.4805" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="280" x2="1016" y1="507.4805" y2="507.4805"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="292" y="503.0488">new_image(bitmap)</text><polygon fill="#A80036" points="94,532.791,84,536.791,94,540.791,90,536.791" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="88" x2="274" y1="536.791" y2="536.791"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="100" y="532.3594">new_image(bitmap)</text><!--
@startuml
participant UI
participant Simulator
participant TracerJobGenerator
participant "Tracer (one of multiple threads)" as Tracer
participant LightSegmentQueue
participant Surface

hnote over UI: User opens app

... The app is at a steady state (everything is intialized and something is being simulated) ...

hnote over UI: User modifies scene

UI -> Simulator: clear_and_simulate(layout)
Simulator -> Surface: clear_and_increment_layout_version()
Simulator -> TracerJobGenerator: reset()
Simulator -> LightSegmentQueue: dequeue_all()
 
Simulator -> Tracer: condvar.notify_all()

activate Tracer
Tracer <-> TracerJobGenerator: dequeue_job()
rnote over Tracer: Trace scene
Tracer -> LightSegmentQueue: enqueue(segments, layout_version)

Tracer -> Surface: condvar.notify_all()
activate Surface

Surface <-> LightSegmentQueue: dequeue_segments()
rnote over Surface: Draw segments if correct layout version
Surface -> Simulator: new_image(bitmap)
deactivate Surface

Simulator -> UI: new_image(bitmap)


deactivate Tracer

@enduml

PlantUML version 1.2017.19(Sun Nov 12 03:46:22 PST 2017)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 9.0.1+11
Operating System: Mac OS X
OS Version: 10.13.2
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>